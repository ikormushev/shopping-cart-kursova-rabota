-- 1. Снабдяване на магазините
INSERT INTO stores (id, name, website_url, created_at)
VALUES
('00000000-0000-0000-0000-000000000002', 'KAUFLAND', 'https://www.kaufland.bg', NOW()),
('00000000-0000-0000-0000-000000000003', 'BILLA', 'https://www.billa.bg', NOW())
ON CONFLICT (id) DO NOTHING;

-- 2. Временна таблица за уникални продукти (1 продукт = 1 ред тук)
CREATE TEMP TABLE real_market_source (brand TEXT, product_name TEXT, group_name TEXT, category_name TEXT, base_price DECIMAL);

INSERT INTO real_market_source (brand, product_name, group_name, category_name, base_price) VALUES
-- МЛЕЧНИ
('Верея', 'Кисело мляко 3.6% 400г', 'кисело мляко верея', 'Млечни', 1.45),
('Верея', 'Кисело мляко 2% 400г', 'кисело мляко верея', 'Млечни', 1.35),
('Верея', 'Прясно мляко 3% 1л', 'прясно мляко верея', 'Млечни', 3.20),
('На Баба', 'Кисело мляко 3.6% 400г', 'кисело мляко на баба', 'Млечни', 1.38),
('Маджаров', 'Краве сирене по БДС кг', 'сирене маджаров', 'Млечни', 18.90),
('Маджаров', 'Кефир 400г', 'кефир маджаров', 'Млечни', 2.10),
('Тертер', 'Кашкавал от краве мляко 400г', 'кашкавал тертер', 'Млечни', 12.50),
('Олимпус', 'Извара 0% масленост 400г', 'извара олимпус', 'Млечни', 3.55),

-- МЕСО И ДЕЛИКАТЕСИ
('Градус', 'Пилешко филе охладено кг', 'пиле градус', 'Месо', 14.50),
('Градус', 'Пилешки крилца кг', 'пиле градус', 'Месо', 7.40),
('Лудогорско пиле', 'Цяло пиле охладено кг', 'пиле лудогорско', 'Месо', 6.80),
('Орехите', 'Суджук класик 160г', 'суджук орехите', 'Месо', 6.90),
('Орехите', 'Луканка Търновска 200г', 'луканка орехите', 'Месо', 8.20),
('Leki', 'Шпеков салам Бургас 230г', 'салам леки', 'Месо', 5.40),
('Кен', 'Кренвирши кг', 'кренвирши кен', 'Месо', 9.90),

-- АЛКОХОЛ И НАПИТКИ (За голям обем записи)
('Астика', 'Бира кен 0.5л', 'бира астика', 'Напитки', 1.25),
('Астика', 'Бира ПЕТ 2л', 'бира астика', 'Напитки', 3.10),
('Туборг', 'Бира кен 0.5л', 'бира туборг', 'Напитки', 1.70),
('Пиринско', 'Пиво кен 0.5л', 'бира пиринско', 'Напитки', 1.35),
('Каменица', 'Бира кен 0.5л', 'бира каменица', 'Напитки', 1.45),
('Загорка', 'Специално кен 0.5л', 'бира загорка', 'Напитки', 1.55),
('Stella Artois', 'Бира кен 0.5л', 'бира stella', 'Напитки', 1.90),
('Jack Daniels', 'Тенеси Уиски 700мл', 'уиски jack daniels', 'Напитки', 42.00),
('Bushmills', 'Ирландско уиски 700мл', 'уиски bushmills', 'Напитки', 34.50),
('Jameson', 'Irish Whiskey 700мл', 'уиски jameson', 'Напитки', 32.00),
('Absolut', 'Водка чиста 700мл', 'водка absolut', 'Напитки', 22.00),
('Flirt', 'Водка 700мл', 'водка flirt', 'Напитки', 11.50),
('Coca-Cola', 'Zero 1.5л', 'кока кола', 'Напитки', 2.45),
('Fanta', 'Портокал 1.5л', 'фанта', 'Напитки', 2.30),
('Девин', 'Минерална вода 1.5л', 'вода девин', 'Напитки', 0.95),

-- КАФЕ И ТОПЛИ НАПИТКИ
('Lavazza', 'Qualita Oro мляно 250г', 'кафе лаваца', 'Напитки', 9.20),
('Lavazza', 'Crema e Gusto 250г', 'кафе лаваца', 'Напитки', 7.40),
('Tchibo', 'Exclusive мляно 250г', 'кафе чибо', 'Напитки', 6.80),
('Нова Бразилия', 'Мляно кафе 200г', 'кафе нова бразилия', 'Напитки', 4.50),
('Jacobs', 'Monarch мляно 250г', 'кафе якобс', 'Напитки', 8.90),

-- СЛАДКИ ИЗДЕЛИЯ
('Milka', 'Шоколад Ягода 100г', 'шоколад милка', 'Захарни', 2.15),
('Milka', 'Шоколад Лешник 100г', 'шоколад милка', 'Захарни', 2.15),
('Lindt', 'Excellence 70% какао 100г', 'шоколад линд', 'Захарни', 5.40),
('Своге', 'Млечен шоколад 80г', 'шоколад своге', 'Захарни', 1.60),
('Нутела', 'Течен шоколад 400г', 'течен шоколад нутела', 'Захарни', 7.50),

-- ПАКЕТИРАНИ И ОСНОВНИ
('София Мел', 'Брашно Тип 500 1кг', 'брашно софия мел', 'Храни', 1.15),
('Крина', 'Ориз Бисерен 1кг', 'ориз крина', 'Храни', 3.80),
('Фамилия', 'Точени кори 400г', 'кори фамилия', 'Храни', 2.10),
('Дерони', 'Лютеница Старозагорска 550г', 'лютеница дерони', 'Храни', 5.40),
('Олинеза', 'Лютеница Първомай 550г', 'лютеница олинеза', 'Храни', 4.90);

-- 3. Създаване на уникалните Продуктови Групи
INSERT INTO product_groups (id, canonical_name, category)
SELECT DISTINCT
    'grp-' || REPLACE(group_name, ' ', '-'),
    group_name,
    category_name
FROM real_market_source
ON CONFLICT (id) DO NOTHING;

-- 4. Наливане на чисти данни (1 продукт -> 2 записа, по един за всеки магазин)
INSERT INTO products (id, group_id, store_id, raw_name, sku, price, currency, created_at)
SELECT
    gen_random_uuid()::text as id,
    'grp-' || REPLACE(src.group_name, ' ', '-') as group_id,
    s.id as store_id,
    src.brand || ' - ' || src.product_name as raw_name,
    src.brand || '_' || REPLACE(src.product_name, ' ', '_') || '_' || s.name as sku,
    (CASE
        WHEN s.name = 'KAUFLAND' THEN src.base_price
        ELSE (src.base_price + (random() * 0.60) - 0.30)
    END)::numeric(10,2) as price,
    'BGN',
    NOW()
FROM
    stores s
CROSS JOIN
    real_market_source src;

DROP TABLE real_market_source;